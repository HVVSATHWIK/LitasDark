(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();function P(c){c.classList.remove("hidden"),c.classList.add("visible")}function v(c){c.classList.remove("visible"),c.classList.add("hidden")}function u(c){f(c,"error")}function f(c,e="info"){const t=document.createElement("div");t.className=`message ${e}`,t.textContent=c,document.body.appendChild(t),setTimeout(()=>{t.classList.add("fade-out"),setTimeout(()=>{document.body.removeChild(t)},1e3)},3e3)}class I{constructor(){this.currentDocument=null,this.loadingCallbacks=new Set}async loadFromFile(e){if(!e||e.type!=="application/pdf")throw new Error("Invalid file type. Please select a PDF file.");if(e.size>50*1024*1024)throw new Error("File too large. Please select a file smaller than 50MB.");try{const t=await e.arrayBuffer();return this.currentDocument=await PDFLib.PDFDocument.load(t),this.notifyLoadingComplete(),this.currentDocument}catch(t){throw this.handleLoadError(t),t}}getCurrentDocument(){return this.currentDocument}isDocumentLoaded(){return this.currentDocument!==null}onLoadingComplete(e){this.loadingCallbacks.add(e)}offLoadingComplete(e){this.loadingCallbacks.delete(e)}notifyLoadingComplete(){this.loadingCallbacks.forEach(e=>{try{e(this.currentDocument)}catch(t){console.error("Error in loading callback:",t)}})}handleLoadError(e){throw e.message.includes("Invalid PDF structure")||e.name==="InvalidPDFException"?new Error("The file appears to be corrupted or not a valid PDF. Please try a different file."):new Error("Failed to load PDF. Please ensure the file is valid.")}}class D{constructor(){this.renderCache=new Map,this.maxCacheSize=10}async renderPage(e,t,r={}){const s=this.getCacheKey(e,t,r);if(this.renderCache.has(s))return this.renderCache.get(s);try{const o=await e.save(),a=await(await pdfjsLib.getDocument({data:o}).promise).getPage(t),d=r.scale||2,i=a.getViewport({scale:d}),l=document.createElement("canvas"),h=l.getContext("2d");return l.width=i.width,l.height=i.height,await a.render({canvasContext:h,viewport:i}).promise,this.applyThemeFilters(h,l.width,l.height,r),this.cacheCanvas(s,l),l}catch(o){throw new Error(`Failed to render page ${t}: ${o.message}`)}}async generateThumbnails(e){const t=e.getPageCount(),r=[],s=3;for(let o=0;o<t;o+=s){const n=[],a=Math.min(o+s,t);for(let i=o;i<a;i++)n.push(this.renderPage(e,i+1,{scale:.5}));(await Promise.allSettled(n)).forEach((i,l)=>{i.status==="fulfilled"?r[o+l]=i.value:(console.error(`Failed to generate thumbnail for page ${o+l+1}:`,i.reason),r[o+l]=this.createErrorThumbnail())})}return r}applyThemeFilters(e,t,r,s){const{theme:o="dark",brightness:n=100,contrast:a=100}=s;e.globalCompositeOperation="difference",e.fillStyle=this.getThemeFillColor(o),e.fillRect(0,0,t,r),e.globalCompositeOperation="source-over",e.filter=`brightness(${n}%) contrast(${a}%)`}getThemeFillColor(e){return{dark:"white",darker:"#ccc",darkest:"#999"}[e]||"white"}getCacheKey(e,t,r){return`${e.getTitle()||"untitled"}_${t}_${JSON.stringify(r)}`}cacheCanvas(e,t){if(this.renderCache.size>=this.maxCacheSize){const r=this.renderCache.keys().next().value;this.renderCache.delete(r)}this.renderCache.set(e,t)}createErrorThumbnail(){const e=document.createElement("canvas");e.width=150,e.height=200;const t=e.getContext("2d");return t.fillStyle="#333",t.fillRect(0,0,e.width,e.height),t.fillStyle="#fff",t.font="14px Arial",t.textAlign="center",t.fillText("Error",e.width/2,e.height/2),e}}class F{constructor(e){this.renderer=e,this.progressCallbacks=new Set}async convertToDarkMode(e,t={}){const r=e.getPageCount(),s=await PDFLib.PDFDocument.create();this.notifyProgress(0,r,"Starting conversion...");try{for(let n=1;n<=r;n++){this.notifyProgress(n-1,r,`Processing page ${n}...`);const a=await this.renderer.renderPage(e,n,t),d=a.toDataURL("image/png"),i=await s.embedPng(d),l=s.addPage([a.width,a.height]);l.drawImage(i,{x:0,y:0,width:l.getWidth(),height:l.getHeight()})}this.notifyProgress(r,r,"Finalizing PDF...");const o=await s.save({useObjectStreams:!0,compress:!0,optimizeForSize:!0});return this.notifyProgress(r,r,"Conversion complete!"),o}catch(o){throw new Error(`Conversion failed: ${o.message}`)}}onProgress(e){this.progressCallbacks.add(e)}offProgress(e){this.progressCallbacks.delete(e)}notifyProgress(e,t,r){this.progressCallbacks.forEach(s=>{try{s(e,t,r)}catch(o){console.error("Error in progress callback:",o)}})}}class E{static handlePDFError(e,t=""){console.error(`PDF Error in ${t}:`,e);const r={"Invalid PDF structure":"The PDF file appears to be corrupted. Please try a different file.",InvalidPDFException:"Invalid PDF format. Please ensure the file is a valid PDF.",getPage:"Failed to access PDF page. The file may be corrupted.",render:"Failed to render PDF page. Please try again.",embedPng:"Failed to process images. The PDF may contain unsupported content.",save:"Failed to save the converted PDF. Please try again."};for(const[s,o]of Object.entries(r))if(e.message.includes(s)||e.name===s)return new Error(o);return new Error(`An unexpected error occurred${t?` in ${t}`:""}. Please try again.`)}static async withErrorHandling(e,t=""){try{return await e()}catch(r){throw this.handlePDFError(r,t)}}}class y{static validateFile(e){if(!e)throw new Error("No file selected");if(e.type!=="application/pdf")throw new Error("Invalid file type. Please select a PDF file.");const t=50*1024*1024;if(e.size>t)throw new Error("File too large. Please select a file smaller than 50MB.");return!0}static validatePageRange(e,t,r){const s=parseInt(e,10),o=parseInt(t,10);if(isNaN(s)||isNaN(o))throw new Error("Page numbers must be valid integers");if(s<1||o<1)throw new Error("Page numbers must be greater than 0");if(s>r||o>r)throw new Error(`Page numbers cannot exceed ${r}`);if(s>o)throw new Error("Start page cannot be greater than end page");return{start:s,end:o}}static validateRotationAngle(e){const t=[0,90,180,270],r=parseInt(e,10);if(!t.includes(r))throw new Error("Rotation angle must be 0, 90, 180, or 270 degrees");return r}static validateThemeSettings(e){const{theme:t,brightness:r,contrast:s}=e;if(t&&!["dark","darker","darkest"].includes(t))throw new Error("Invalid theme selection");if(r!==void 0){const n=parseInt(r,10);if(isNaN(n)||n<50||n>150)throw new Error("Brightness must be between 50 and 150")}if(s!==void 0){const n=parseInt(s,10);if(isNaN(n)||n<50||n>150)throw new Error("Contrast must be between 50 and 150")}return!0}}class L{constructor(){this.pdfLoader=new I,this.pdfRenderer=new D,this.pdfConverter=new F(this.pdfRenderer),this.initializeEventListeners(),this.setupProgressHandling()}initializeEventListeners(){document.getElementById("pdfUpload").addEventListener("change",e=>{this.handleFileUpload(e.target.files[0])}),document.getElementById("generatePreviewButton").addEventListener("click",()=>{this.generatePreview()}),document.getElementById("convertButton").addEventListener("click",()=>{this.convertToDarkMode()}),["themeSelect","brightness","contrast"].forEach(e=>{document.getElementById(e).addEventListener("change",()=>{this.updatePreview()})}),document.getElementById("splitButton").addEventListener("click",()=>{this.splitPDF()}),document.getElementById("mergeButton").addEventListener("click",()=>{this.mergePDFs()}),document.getElementById("rotateButton").addEventListener("click",()=>{this.rotatePage()}),document.getElementById("backToTop").addEventListener("click",e=>{e.preventDefault(),window.scrollTo({top:0,behavior:"smooth"})})}setupProgressHandling(){this.pdfConverter.onProgress((e,t,r)=>{this.updateProgressBar(e,t,r)})}async handleFileUpload(e){if(!e)return;const t=document.getElementById("loading");try{y.validateFile(e),P(t),await this.pdfLoader.loadFromFile(e),await this.generateThumbnails(),f("PDF loaded successfully! Generate a preview to see the dark mode effect.")}catch(r){u(r.message)}finally{v(t)}}async generateThumbnails(){const e=this.pdfLoader.getCurrentDocument();if(e)try{const t=await this.pdfRenderer.generateThumbnails(e),r=document.getElementById("thumbnails");r.innerHTML="",t.forEach((s,o)=>{if(s){const n=document.createElement("div");n.classList.add("thumbnail"),n.appendChild(s),n.setAttribute("role","button"),n.setAttribute("aria-label",`Page ${o+1} preview`),n.tabIndex=0,n.addEventListener("click",()=>{this.renderPage(o+1)}),r.appendChild(n)}})}catch(t){console.error("Error generating thumbnails:",t)}}async renderPage(e){const t=this.pdfLoader.getCurrentDocument();if(t)try{const r=this.getThemeSettings(),s=await this.pdfRenderer.renderPage(t,e,r);this.displayPreview(s)}catch{u(`Failed to render page ${e}`)}}async generatePreview(){if(!this.pdfLoader.isDocumentLoaded()){u("Please upload a PDF file first.");return}const e=document.getElementById("loading");try{P(e);const t=this.getThemeSettings(),r=this.pdfLoader.getCurrentDocument(),s=await this.pdfRenderer.renderPage(r,1,t);this.displayPreview(s),document.getElementById("preview").style.display="block"}catch(t){const r=E.handlePDFError(t,"preview generation");u(r.message)}finally{v(e)}}async updatePreview(){this.pdfLoader.isDocumentLoaded()&&await this.generatePreview()}async convertToDarkMode(){if(!this.pdfLoader.isDocumentLoaded()){u("Please upload a PDF file first.");return}const e=document.getElementById("loading");try{P(e);const t=this.getThemeSettings(),r=this.pdfLoader.getCurrentDocument(),s=await this.pdfConverter.convertToDarkMode(r,t);this.downloadPDF(s,"dark-mode.pdf"),f("PDF converted successfully!")}catch(t){const r=E.handlePDFError(t,"conversion");u(r.message)}finally{v(e)}}async splitPDF(){if(!this.pdfLoader.isDocumentLoaded()){u("Please upload a PDF file first.");return}try{const e=document.getElementById("startPage").value,t=document.getElementById("endPage").value,r=this.pdfLoader.getCurrentDocument(),{start:s,end:o}=y.validatePageRange(e,t,r.getPageCount()),n=await PDFLib.PDFDocument.create();(await n.copyPages(r,[...Array(o-s+1).keys()].map(i=>i+s-1))).forEach(i=>{n.addPage(i)});const d=await n.save();this.downloadPDF(d,"split_pdf.pdf","splitDownloadLink"),f("PDF split successfully!")}catch(e){u(e.message)}}async mergePDFs(){const e=document.getElementById("pdfFiles").files;if(e.length===0){u("Please select PDF files to merge.");return}try{const t=await PDFLib.PDFDocument.create(),r=[];for(const o of e){y.validateFile(o);const n=await o.arrayBuffer(),a=await PDFLib.PDFDocument.load(n);(await t.copyPages(a,a.getPageIndices())).forEach(i=>{t.addPage(i)}),r.push(o.name.replace(".pdf",""))}const s=await t.save();this.downloadPDF(s,`${r.join("_")}_merged.pdf`,"mergeDownloadLink"),f("PDFs merged successfully!")}catch(t){u(`Failed to merge PDFs: ${t.message}`)}}async rotatePage(){if(!this.pdfLoader.isDocumentLoaded()){u("Please upload a PDF file first.");return}try{const e=document.getElementById("rotatePageNumber").value,t=document.getElementById("rotateAngle").value,r=this.pdfLoader.getCurrentDocument(),s=parseInt(e,10),o=y.validateRotationAngle(t);if(s<1||s>r.getPageCount())throw new Error(`Page number must be between 1 and ${r.getPageCount()}`);r.getPage(s-1).setRotation(PDFLib.degrees(o));const a=await r.save();this.downloadPDF(a,"rotated_pdf.pdf","rotateDownloadLink"),f("Page rotated successfully!")}catch(e){u(e.message)}}getThemeSettings(){const e={theme:document.getElementById("themeSelect").value,brightness:parseInt(document.getElementById("brightness").value,10),contrast:parseInt(document.getElementById("contrast").value,10),scale:1.5};try{y.validateThemeSettings(e)}catch(t){return u(t.message),{theme:"dark",brightness:100,contrast:100,scale:1.5}}return e}displayPreview(e){const t=document.getElementById("previewCanvas"),r=t.getContext("2d");t.width=e.width,t.height=e.height,r.drawImage(e,0,0)}downloadPDF(e,t,r="downloadLink"){try{const s=new Blob([e],{type:"application/pdf"}),o=URL.createObjectURL(s),n=document.createElement("a");n.href=o,n.download=t,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n);const a=document.getElementById(r);a&&(a.href=o,a.download=t,a.style.display="block",a.textContent=`Download ${t}`),setTimeout(()=>{URL.revokeObjectURL(o)},5e3),f(`${t} is ready for download!`)}catch(s){console.error("Download error:",s),u("Failed to download PDF. Please try again.")}}updateProgressBar(e,t,r){const s=document.getElementById("progressBar");if(s){const o=e/t*100;s.style.width=`${o}%`,s.setAttribute("aria-valuenow",o),s.setAttribute("aria-valuetext",r)}}}class C{constructor(){this.supportedOperations=["watermark","metadata","compression"]}async addWatermark(e,t,r={}){const{opacity:s=.3,rotation:o=45,fontSize:n=50,color:a=[.5,.5,.5],position:d="center"}=r,i=e.getPageCount();try{for(let l=0;l<i;l++){const h=e.getPage(l),{width:p,height:w}=h.getSize();let g,m;switch(d){case"center":g=p/2,m=w/2;break;case"top-left":g=50,m=w-50;break;case"top-right":g=p-50,m=w-50;break;case"bottom-left":g=50,m=50;break;case"bottom-right":g=p-50,m=50;break;default:g=p/2,m=w/2}h.drawText(t,{x:g,y:m,size:n,color:PDFLib.rgb(...a),opacity:s,rotate:PDFLib.degrees(o)})}return await e.save()}catch(l){throw new Error(`Failed to add watermark: ${l.message}`)}}async removeMetadata(e){try{return e.setTitle(""),e.setAuthor(""),e.setSubject(""),e.setKeywords([]),e.setProducer(""),e.setCreator(""),e.setCreationDate(new Date),e.setModificationDate(new Date),await e.save({useObjectStreams:!1,addDefaultPage:!1})}catch(t){throw new Error(`Failed to remove metadata: ${t.message}`)}}async compressPDF(e,t={}){const{useObjectStreams:r=!0,compress:s=!0,optimizeForSize:o=!0}=t;try{return await e.save({useObjectStreams:r,compress:s,optimizeForSize:o,addDefaultPage:!1})}catch(n){throw new Error(`Failed to compress PDF: ${n.message}`)}}getDocumentInfo(e){try{return{pageCount:e.getPageCount(),title:e.getTitle()||"Untitled",author:e.getAuthor()||"Unknown",subject:e.getSubject()||"",keywords:e.getKeywords()||[],creator:e.getCreator()||"",producer:e.getProducer()||"",creationDate:e.getCreationDate(),modificationDate:e.getModificationDate()}}catch(t){return console.error("Error extracting document info:",t),{pageCount:e.getPageCount(),title:"Untitled",author:"Unknown",subject:"",keywords:[],creator:"",producer:"",creationDate:null,modificationDate:null}}}}class B{constructor(e,t){this.converter=e,this.processor=t,this.queue=[],this.isProcessing=!1,this.progressCallbacks=new Set,this.results=[]}addToQueue(e,t){const r=Array.from(e).map(s=>({id:Date.now()+Math.random(),file:s,settings:t,status:"pending"}));return this.queue.push(...r),r.map(s=>s.id)}async startProcessing(){if(this.isProcessing)throw new Error("Batch processing is already in progress");this.isProcessing=!0,this.results=[];const e=this.queue.length;try{for(let t=0;t<e;t++){const r=this.queue[t];this.notifyProgress(t,e,`Processing ${r.file.name}`);try{r.status="processing";const s=await this.processFile(r.file,r.settings);this.results.push({id:r.id,filename:r.file.name,success:!0,result:s,size:s.byteLength}),r.status="completed"}catch(s){this.results.push({id:r.id,filename:r.file.name,success:!1,error:s.message}),r.status="failed",console.error(`Failed to process ${r.file.name}:`,s)}}return this.notifyProgress(e,e,"Batch processing complete"),this.results}finally{this.isProcessing=!1}}async processFile(e,t){const r=await e.arrayBuffer(),s=await PDFLib.PDFDocument.load(r);let o=s;if(t.convertToDarkMode){const n=await this.converter.convertToDarkMode(s,t.themeSettings);o=await PDFLib.PDFDocument.load(n)}if(t.addWatermark&&t.watermarkText){const n=await this.processor.addWatermark(o,t.watermarkText,t.watermarkOptions);o=await PDFLib.PDFDocument.load(n)}if(t.removeMetadata){const n=await this.processor.removeMetadata(o);o=await PDFLib.PDFDocument.load(n)}return t.compress?await this.processor.compressPDF(o,t.compressionOptions):await o.save()}async downloadAllAsZip(){if(this.results.length===0)throw new Error("No processed files to download");this.results.forEach((e,t)=>{e.success&&setTimeout(()=>{this.downloadFile(e.result,e.filename,t*100)},t*100)})}downloadFile(e,t,r=0){setTimeout(()=>{const s=new Blob([e],{type:"application/pdf"}),o=URL.createObjectURL(s),n=document.createElement("a");n.href=o,n.download=`processed_${t}`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(o)},r)}clearQueue(){if(this.isProcessing)throw new Error("Cannot clear queue while processing");this.queue=[],this.results=[]}getStatus(){return{queueLength:this.queue.length,isProcessing:this.isProcessing,completed:this.results.filter(e=>e.success).length,failed:this.results.filter(e=>!e.success).length}}onProgress(e){this.progressCallbacks.add(e)}offProgress(e){this.progressCallbacks.delete(e)}notifyProgress(e,t,r){this.progressCallbacks.forEach(s=>{try{s(e,t,r)}catch(o){console.error("Error in progress callback:",o)}})}}const x="modulepreload",k=function(c){return"/"+c},b={},T=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),a=(n==null?void 0:n.nonce)||(n==null?void 0:n.getAttribute("nonce"));s=Promise.allSettled(t.map(d=>{if(d=k(d),d in b)return;b[d]=!0;const i=d.endsWith(".css"),l=i?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${l}`))return;const h=document.createElement("link");if(h.rel=i?"stylesheet":x,i||(h.as="script"),h.crossOrigin="",h.href=d,a&&h.setAttribute("nonce",a),document.head.appendChild(h),i)return new Promise((p,w)=>{h.addEventListener("load",p),h.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${d}`)))})}))}function o(n){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=n,window.dispatchEvent(a),!a.defaultPrevented)throw n}return s.then(n=>{for(const a of n||[])a.status==="rejected"&&o(a.reason);return e().catch(o)})};class U{constructor(){this.worker=null,this.isInitialized=!1,this.isLoading=!1}async initialize(){if(!(this.isInitialized||this.isLoading)){this.isLoading=!0;try{const{createWorker:e}=await T(async()=>{const{createWorker:t}=await import("./index-BZH6TDpT.js").then(r=>r.i);return{createWorker:t}},[]);this.worker=await e("eng",1,{logger:t=>{t.status==="recognizing text"&&console.log(`OCR Progress: ${Math.round(t.progress*100)}%`)}}),this.isInitialized=!0}catch(e){throw console.error("Failed to initialize OCR:",e),new Error("OCR initialization failed. Please check your internet connection.")}finally{this.isLoading=!1}}}async recognizeText(e,t={}){if(this.isInitialized||await this.initialize(),!this.worker)throw new Error("OCR worker not initialized");try{const{data:r}=await this.worker.recognize(e,{rectangle:t.rectangle});return{text:r.text,confidence:r.confidence,words:r.words.map(s=>({text:s.text,confidence:s.confidence,bbox:s.bbox})),lines:r.lines.map(s=>({text:s.text,confidence:s.confidence,bbox:s.bbox}))}}catch(r){throw new Error(`OCR recognition failed: ${r.message}`)}}async recognizeMultiplePages(e,t){this.isInitialized||await this.initialize();const r=[],s=e.length;for(let o=0;o<s;o++){t&&t(o,s,`Processing page ${o+1}...`);try{const n=await this.recognizeText(e[o]);r.push({pageNumber:o+1,success:!0,...n})}catch(n){r.push({pageNumber:o+1,success:!1,error:n.message})}}return t&&t(s,s,"OCR processing complete"),r}searchText(e,t,r=!1){const s=[],o=r?t:t.toLowerCase();return e.forEach(n=>{if(!n.success)return;(r?n.text:n.text.toLowerCase()).includes(o)&&n.words.forEach(d=>{(r?d.text:d.text.toLowerCase()).includes(o)&&s.push({pageNumber:n.pageNumber,text:d.text,confidence:d.confidence,bbox:d.bbox,context:this.getWordContext(n.words,d,5)})})}),s}getWordContext(e,t,r=5){const s=e.findIndex(a=>a===t);if(s===-1)return t.text;const o=Math.max(0,s-r),n=Math.min(e.length,s+r+1);return e.slice(o,n).map(a=>a.text).join(" ")}exportResults(e,t="txt"){switch(t.toLowerCase()){case"txt":return e.filter(s=>s.success).map(s=>`Page ${s.pageNumber}:
${s.text}
`).join(`
---

`);case"json":return JSON.stringify(e,null,2);case"csv":const r=["Page,Text,Confidence"];return e.forEach(s=>{if(s.success){const o=s.text.replace(/"/g,'""').replace(/\n/g," ");r.push(`${s.pageNumber},"${o}",${s.confidence}`)}}),r.join(`
`);default:throw new Error(`Unsupported export format: ${t}`)}}async terminate(){this.worker&&(await this.worker.terminate(),this.worker=null,this.isInitialized=!1)}isAvailable(){return typeof window<"u"&&"Worker"in window}}class $ extends L{constructor(){super(),this.pdfProcessor=new C,this.batchProcessor=new B(this.pdfConverter,this.pdfProcessor),this.ocrProcessor=new U,this.currentOCRResults=[],this.modernUI=null,this.initializeEnhancedFeatures(),this.initializeModernUI()}async initializeModernUI(){window.modernUI?this.modernUI=window.modernUI:setTimeout(()=>this.initializeModernUI(),100)}initializeEnhancedFeatures(){var e,t,r,s,o,n,a,d;this.setupEnhancedFileUpload(),(e=document.getElementById("batchUpload"))==null||e.addEventListener("change",i=>{this.handleBatchUpload(i.target.files)}),(t=document.getElementById("startBatchButton"))==null||t.addEventListener("click",()=>{this.startBatchProcessing()}),(r=document.getElementById("addWatermarkButton"))==null||r.addEventListener("click",()=>{this.addWatermark()}),(s=document.getElementById("extractTextButton"))==null||s.addEventListener("click",()=>{this.extractTextFromPDF()}),(o=document.getElementById("searchTextButton"))==null||o.addEventListener("click",()=>{this.searchInPDF()}),(n=document.getElementById("showInfoButton"))==null||n.addEventListener("click",()=>{this.showDocumentInfo()}),(a=document.getElementById("compressButton"))==null||a.addEventListener("click",()=>{this.compressPDF()}),(d=document.getElementById("removeMetadataButton"))==null||d.addEventListener("click",()=>{this.removeMetadata()}),this.batchProcessor.onProgress((i,l,h)=>{this.updateProgressBar(i,l,h),this.modernUI&&this.modernUI.showProgress(i,l,h)}),this.setupZoomControls()}setupEnhancedFileUpload(){const e=document.getElementById("pdfUpload");if(!e)return;const t=e.closest(".upload-zone")||e.parentElement;["dragenter","dragover","dragleave","drop"].forEach(r=>{t.addEventListener(r,s=>{s.preventDefault(),s.stopPropagation()})}),["dragenter","dragover"].forEach(r=>{t.addEventListener(r,()=>{t.classList.add("drag-over")})}),["dragleave","drop"].forEach(r=>{t.addEventListener(r,()=>{t.classList.remove("drag-over")})}),t.addEventListener("drop",r=>{const s=r.dataTransfer.files;s.length>0&&s[0].type==="application/pdf"&&(e.files=s,this.handleFileUpload(s[0]))})}setupZoomControls(){var s,o,n;let e=100;const t=document.getElementById("zoomLevel"),r=document.getElementById("previewCanvas");(s=document.getElementById("zoomIn"))==null||s.addEventListener("click",()=>{e=Math.min(e+25,200),this.updateZoom(e,t,r)}),(o=document.getElementById("zoomOut"))==null||o.addEventListener("click",()=>{e=Math.max(e-25,50),this.updateZoom(e,t,r)}),(n=document.getElementById("resetZoom"))==null||n.addEventListener("click",()=>{e=100,this.updateZoom(e,t,r)})}updateZoom(e,t,r){t&&(t.textContent=`${e}%`),r&&(r.style.transform=`scale(${e/100})`,r.style.transformOrigin="center")}async handleFileUpload(e){var t;if(e){document.getElementById("loading");try{this.modernUI&&this.modernUI.showToast("Uploading PDF...","info"),await super.handleFileUpload(e),this.modernUI&&this.modernUI.showToast("PDF uploaded successfully!","success"),(t=document.getElementById("preview"))==null||t.style.setProperty("display","block")}catch(r){this.modernUI&&this.modernUI.showToast(r.message,"error")}}}async generatePreview(){var r,s;const e=document.getElementById("generatePreviewButton");if(!e)return;const t=((r=this.modernUI)==null?void 0:r.createLoadingState(e,"Generating..."))||(()=>{});try{await super.generatePreview(),this.modernUI&&this.modernUI.showToast("Preview generated successfully!","success"),(s=document.getElementById("preview"))==null||s.scrollIntoView({behavior:"smooth",block:"start"})}catch(o){this.modernUI&&this.modernUI.showToast(o.message,"error")}finally{t()}}async convertToDarkMode(){var r;const e=document.getElementById("convertButton");if(!e)return;const t=((r=this.modernUI)==null?void 0:r.createLoadingState(e,"Converting..."))||(()=>{});try{await super.convertToDarkMode();const s=document.getElementById("downloadSection");s&&(s.style.display="block",s.scrollIntoView({behavior:"smooth",block:"start"})),this.modernUI&&this.modernUI.showToast("PDF converted to dark mode successfully!","success")}catch(s){this.modernUI&&this.modernUI.showToast(s.message,"error")}finally{t()}}async handleBatchUpload(e){if(!(!e||e.length===0))try{const t=this.getBatchSettings(),r=this.batchProcessor.addToQueue(e,t);this.modernUI&&this.modernUI.showToast(`Added ${e.length} files to batch queue`,"success"),this.updateBatchQueueDisplay()}catch(t){this.modernUI&&this.modernUI.showToast(`Failed to add files to queue: ${t.message}`,"error")}}async startBatchProcessing(){var r;const e=document.getElementById("startBatchButton");if(!e)return;const t=((r=this.modernUI)==null?void 0:r.createLoadingState(e,"Processing..."))||(()=>{});try{const s=await this.batchProcessor.startProcessing(),o=s.filter(a=>a.success).length,n=s.filter(a=>!a.success).length;this.modernUI&&this.modernUI.showToast(`Batch processing complete: ${o} successful, ${n} failed`,o>0?"success":"warning"),o>0&&await this.batchProcessor.downloadAllAsZip(),this.updateBatchQueueDisplay()}catch(s){this.modernUI&&this.modernUI.showToast(`Batch processing failed: ${s.message}`,"error")}finally{t()}}async extractTextFromPDF(){var r;const e=document.getElementById("extractTextButton");if(!e)return;const t=((r=this.modernUI)==null?void 0:r.createLoadingState(e,"Extracting..."))||(()=>{});try{await super.extractTextFromPDF(),this.modernUI&&this.modernUI.showToast("Text extraction completed!","success")}catch(s){this.modernUI&&this.modernUI.showToast(`Text extraction failed: ${s.message}`,"error")}finally{t()}}async showDocumentInfo(){try{await super.showDocumentInfo(),this.modernUI&&this.modernUI.showToast("Document information loaded","info")}catch(e){this.modernUI&&this.modernUI.showToast(`Failed to get document info: ${e.message}`,"error")}}displayOCRResults(){super.displayOCRResults();const e=document.getElementById("ocrResults");e&&(e.classList.add("space-y-4"),e.querySelectorAll(".ocr-result").forEach(t=>{t.classList.add("p-4","bg-gray-50","rounded-lg","border","border-gray-200")}))}updateBatchQueueDisplay(){const e=this.batchProcessor.getStatus(),t=document.getElementById("batchStatus");t&&(t.innerHTML=`
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 p-4 bg-gray-50 rounded-lg">
          <div class="text-center">
            <div class="text-2xl font-bold text-blue-600">${e.queueLength}</div>
            <div class="text-sm text-gray-600">In Queue</div>
          </div>
          <div class="text-center">
            <div class="text-2xl font-bold text-green-600">${e.completed}</div>
            <div class="text-sm text-gray-600">Completed</div>
          </div>
          <div class="text-center">
            <div class="text-2xl font-bold text-red-600">${e.failed}</div>
            <div class="text-sm text-gray-600">Failed</div>
          </div>
          <div class="text-center">
            <div class="text-sm font-medium ${e.isProcessing?"text-blue-600":"text-gray-600"}">
              ${e.isProcessing?"Processing...":"Ready"}
            </div>
          </div>
        </div>
      `)}downloadPDF(e,t,r="downloadLink"){try{super.downloadPDF(e,t,r),this.modernUI&&this.modernUI.showToast(`${t} is ready for download!`,"success")}catch{this.modernUI&&this.modernUI.showToast("Failed to download PDF. Please try again.","error")}}updateProgressBar(e,t,r){super.updateProgressBar(e,t,r);const s=document.getElementById("loadingMessage"),o=document.getElementById("loadingProgress");if(s&&(s.textContent=r),o){const n=Math.round(e/t*100);o.textContent=`${e} of ${t} (${n}%)`}}cleanup(){super.cleanup(),this.ocrProcessor.terminate()}}window.enhancedUI=null;document.addEventListener("DOMContentLoaded",()=>{const c=new $;window.enhancedUI=c,window.addEventListener("beforeunload",()=>{c.cleanup()})});window.addEventListener("error",c=>{console.error("Global error:",c.error)});window.addEventListener("unhandledrejection",c=>{console.error("Unhandled promise rejection:",c.reason),c.preventDefault()});"serviceWorker"in navigator&&window.addEventListener("load",()=>{});
